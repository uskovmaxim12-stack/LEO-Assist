<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEO ASSIST - Умный помощник для 7Б класса</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Частицы на фоне -->
    <div id="particles-js"></div>
    
    <!-- Главный контейнер -->
    <div class="main-container">
        <!-- Левая панель -->
        <div class="left-panel">
            <div class="neural-network">
                <h1><i class="fas fa-brain"></i> LEO ASSISTANT</h1>
                <p class="subtitle">Искусственный интеллект для 7Б класса</p>
                
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-robot"></i>
                        <span>AI-помощник по учёбе</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Расписание уроков</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-tasks"></i>
                        <span>Домашние задания</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-gamepad"></i>
                        <span>Обучающие игры</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Правая панель -->
        <div class="right-panel">
            <div class="auth-container">
                <!-- Вкладки -->
                <div class="auth-tabs">
                    <button class="tab-btn active" onclick="switchTab('login')">
                        <i class="fas fa-sign-in-alt"></i> Вход
                    </button>
                    <button class="tab-btn" onclick="switchTab('register')">
                        <i class="fas fa-user-plus"></i> Регистрация
                    </button>
                    <button class="tab-btn admin-btn" onclick="switchTab('admin')">
                        <i class="fas fa-shield-alt"></i> Админ
                    </button>
                </div>
                
                <!-- Форма ВХОДА -->
                <div class="auth-form active" id="login-form">
                    <h2>Вход в систему</h2>
                    <p class="form-subtitle">Введите ваши данные для доступа</p>
                    
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="login-username" placeholder="Логин" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="login-password" placeholder="Пароль" required>
                    </div>
                    
                    <button class="submit-btn" onclick="login()">
                        <i class="fas fa-paper-plane"></i> Войти в систему
                    </button>
                    
                    <div class="demo-note">
                        <p>Для тестирования:</p>
                        <p>Логин: <strong>admin</strong></p>
                        <p>Пароль: <strong>admin123</strong></p>
                    </div>
                    
                    <div id="login-message" class="message-box"></div>
                </div>
                
                <!-- Форма РЕГИСТРАЦИИ -->
                <div class="auth-form" id="register-form">
                    <h2>Регистрация</h2>
                    <p class="form-subtitle">Создайте новый аккаунт</p>
                    
                    <div class="input-group">
                        <i class="fas fa-id-card"></i>
                        <input type="text" id="reg-fullname" placeholder="Фамилия и Имя" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-at"></i>
                        <input type="text" id="reg-username" placeholder="Придумайте логин" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="reg-password" placeholder="Придумайте пароль" required>
                    </div>
                    
                    <button class="submit-btn" onclick="register()">
                        <i class="fas fa-user-plus"></i> Зарегистрироваться
                    </button>
                    
                    <div id="register-message" class="message-box"></div>
                </div>
                
                <!-- Форма АДМИНА -->
                <div class="auth-form" id="admin-form">
                    <h2>Административный доступ</h2>
                    <p class="form-subtitle">Только для администраторов системы</p>
                    
                    <div class="input-group">
                        <i class="fas fa-key"></i>
                        <input type="password" id="admin-key" placeholder="Ключ доступа" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="admin-password" placeholder="Пароль администратора" required>
                    </div>
                    
                    <button class="submit-btn warning" onclick="adminLogin()">
                        <i class="fas fa-shield-alt"></i> Войти в админ-панель
                    </button>
                    
                    <div class="admin-note">
                        <p><strong>Ключ доступа:</strong> LEO7B2024</p>
                        <p><strong>Пароль:</strong> admin123</p>
                    </div>
                    
                    <div id="admin-message" class="message-box"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Скрипты -->
    <script src="./js/particles.min.js"></script>
    <script>
        // Инициализация частиц
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: ["#00c6ff", "#0072ff", "#ff6b9d"] },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#00c6ff",
                    opacity: 0.2,
                    width: 1
                },
                move: { enable: true, speed: 2, direction: "none", random: true }
            }
        });
        
        // Проверка существующей сессии
        checkSession();
        
        function checkSession() {
            const session = localStorage.getItem('leo_session');
            if (session) {
                try {
                    const user = JSON.parse(session);
                    if (user && user.active) {
                        // Немедленный редирект
                        window.location.href = user.role === 'admin' ? 'admin.html' : 'dashboard.html';
                    }
                } catch (e) {
                    localStorage.removeItem('leo_session');
                }
            }
        }
        
        // Переключение вкладок
        function switchTab(tabName) {
            // Скрываем все формы
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // Убираем активный класс у всех кнопок
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Показываем выбранную форму
            document.getElementById(`${tabName}-form`).classList.add('active');
            
            // Активируем кнопку
            event.target.classList.add('active');
            
            // Очищаем сообщения
            clearMessages();
        }
        
        // Очистка сообщений
        function clearMessages() {
            document.querySelectorAll('.message-box').forEach(box => {
                box.style.display = 'none';
                box.textContent = '';
            });
        }
        
        // Показать сообщение
        function showMessage(text, type, elementId) {
            const messageBox = document.getElementById(elementId);
            if (!messageBox) return;
            
            messageBox.textContent = text;
            messageBox.className = `message-box ${type}`;
            messageBox.style.display = 'block';
            
            setTimeout(() => {
                messageBox.style.opacity = '0';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                    messageBox.style.opacity = '1';
                }, 300);
            }, 5000);
        }
        
        // Хэширование пароля
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'leo_' + Math.abs(hash).toString(36);
        }
        
        // Вход в систему
        function login() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                showMessage('Заполните все поля', 'error', 'login-message');
                return;
            }
            
            // Получаем пользователей из localStorage
            const users = JSON.parse(localStorage.getItem('leo_users') || '[]');
            const hashedPassword = hashPassword(password);
            
            // Ищем пользователя
            const user = users.find(u => u.username === username && u.password === hashedPassword);
            
            if (user) {
                if (user.active) {
                    // Сохраняем сессию
                    localStorage.setItem('leo_session', JSON.stringify(user));
                    
                    showMessage('Вход выполнен! Перенаправляем...', 'success', 'login-message');
                    
                    // Немедленный редирект
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                } else {
                    showMessage('Аккаунт не активирован. Обратитесь к администратору.', 'warning', 'login-message');
                }
            } else {
                showMessage('Неверный логин или пароль', 'error', 'login-message');
            }
        }
        
        // Регистрация
        function register() {
            const fullname = document.getElementById('reg-fullname').value.trim();
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;
            
            if (!fullname || !username || !password) {
                showMessage('Заполните все поля', 'error', 'register-message');
                return;
            }
            
            if (password.length < 6) {
                showMessage('Пароль должен быть не менее 6 символов', 'error', 'register-message');
                return;
            }
            
            // Проверка уникальности
            const users = JSON.parse(localStorage.getItem('leo_users') || '[]');
            if (users.some(u => u.username === username)) {
                showMessage('Этот логин уже занят', 'error', 'register-message');
                return;
            }
            
            // Создаем аватар
            function generateAvatar(name) {
                const names = name.split(' ');
                if (names.length >= 2) {
                    return (names[0][0] + names[1][0]).toUpperCase();
                }
                return name.substring(0, 2).toUpperCase();
            }
            
            // Создаем пользователя
            const newUser = {
                id: Date.now(),
                fullname: fullname,
                username: username,
                password: hashPassword(password),
                role: 'student',
                class: '7Б',
                points: 0,
                level: 1,
                avatar: generateAvatar(fullname),
                active: true, // Автоматически активируем для тестирования
                registeredAt: new Date().toISOString(),
                lastLogin: null
            };
            
            // Сохраняем
            users.push(newUser);
            localStorage.setItem('leo_users', JSON.stringify(users));
            
            showMessage('Регистрация успешна! Теперь вы можете войти.', 'success', 'register-message');
            
            // Очищаем форму и переключаем на вкладку входа
            setTimeout(() => {
                document.getElementById('reg-fullname').value = '';
                document.getElementById('reg-username').value = '';
                document.getElementById('reg-password').value = '';
                switchTab('login');
            }, 2000);
        }
        
        // Вход администратора
        function adminLogin() {
            const key = document.getElementById('admin-key').value.trim();
            const password = document.getElementById('admin-password').value;
            
            if (key !== 'LEO7B2024') {
                showMessage('Неверный ключ доступа', 'error', 'admin-message');
                return;
            }
            
            // Ищем администратора
            const users = JSON.parse(localStorage.getItem('leo_users') || '[]');
            const hashedPassword = hashPassword(password);
            const admin = users.find(u => u.username === 'admin' && u.password === hashedPassword);
            
            if (admin) {
                // Сохраняем сессию
                localStorage.setItem('leo_session', JSON.stringify(admin));
                
                showMessage('Доступ предоставлен. Перенаправляем...', 'success', 'admin-message');
                
                // Немедленный редирект
                setTimeout(() => {
                    window.location.href = 'admin.html';
                }, 1000);
            } else {
                showMessage('Неверный пароль', 'error', 'admin-message');
            }
        }
        
        // Инициализация базы данных при первой загрузке
        function initDatabase() {
            if (!localStorage.getItem('leo_users')) {
                const users = [];
                
                // Создаем администратора
                const admin = {
                    id: 1,
                    fullname: 'Администратор системы',
                    username: 'admin',
                    password: hashPassword('admin123'),
                    role: 'admin',
                    class: '7Б',
                    points: 0,
                    level: 1,
                    avatar: 'АД',
                    active: true,
                    registeredAt: new Date().toISOString(),
                    lastLogin: null
                };
                
                users.push(admin);
                localStorage.setItem('leo_users', JSON.stringify(users));
                
                console.log('✅ База данных инициализирована');
            }
        }
        
        // Инициализация при загрузке
        initDatabase();
        
        // Обработка клавиши Enter
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeForm = document.querySelector('.auth-form.active');
                if (activeForm.id === 'login-form') {
                    login();
                } else if (activeForm.id === 'register-form') {
                    register();
                } else if (activeForm.id === 'admin-form') {
                    adminLogin();
                }
            }
        });
    </script>
</body>
</html>
